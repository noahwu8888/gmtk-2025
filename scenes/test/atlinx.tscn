[gd_scene load_steps=20 format=3 uid="uid://t6jjkf7w2aip"]

[ext_resource type="Script" uid="uid://bwhkujh3jeruh" path="res://scripts/world.gd" id="1_dfbem"]
[ext_resource type="PackedScene" uid="uid://bbkdkp0428yji" path="res://prefabs/player.tscn" id="2_r5bww"]
[ext_resource type="Script" uid="uid://boimiilxj3n2b" path="res://addons/cameraregion2d/CameraRegionController2D.gd" id="3_rdygh"]
[ext_resource type="PackedScene" uid="uid://dktcdyv405i1p" path="res://prefabs/loop_bar.tscn" id="4_u2tkb"]
[ext_resource type="Script" uid="uid://dc1got8i8eqpe" path="res://scripts/level_manager.gd" id="5_kt1sm"]
[ext_resource type="PackedScene" uid="uid://but84a2ah4oj8" path="res://prefabs/rooms/room_1.tscn" id="6_rw0ho"]
[ext_resource type="PackedScene" uid="uid://bhgotk0stngoq" path="res://prefabs/rooms/room_2.tscn" id="7_h7aby"]
[ext_resource type="PackedScene" uid="uid://drysfw5lr2cq5" path="res://prefabs/rooms/room_3.tscn" id="8_vbhdp"]
[ext_resource type="Script" uid="uid://drr3hic848gx0" path="res://scripts/level.gd" id="9_4pava"]
[ext_resource type="Script" uid="uid://dqi2pls0xboqr" path="res://addons/rhythm_notifier/rhythm_notifier.gd" id="10_ko8bd"]
[ext_resource type="Script" uid="uid://deofdsnkjeipf" path="res://scripts/music/audio_track_manager.gd" id="11_0v5xw"]
[ext_resource type="Script" uid="uid://5vpj6ph24507" path="res://scripts/fx/fx.gd" id="11_r5bww"]
[ext_resource type="AudioStream" uid="uid://bxamnrwj8w5xu" path="res://assets/music/test/metro.ogg" id="12_bbun0"]
[ext_resource type="AudioStream" uid="uid://dhhlxrdkb8gx" path="res://assets/sfx/crash.ogg" id="12_rdygh"]
[ext_resource type="AudioStream" uid="uid://d3uf2kkgotct3" path="res://assets/music/test/metro_2.ogg" id="13_cjd40"]
[ext_resource type="AudioStream" uid="uid://b1b042vblllv8" path="res://assets/music/test/TwoSisters_Level_Base.ogg" id="14_4741j"]
[ext_resource type="AudioStream" uid="uid://be3bj08upc4oc" path="res://assets/music/test/intensity.ogg" id="15_d85kv"]
[ext_resource type="AudioStream" uid="uid://dsn47jtmwqpfi" path="res://assets/music/test/mystery.ogg" id="16_vm263"]

[sub_resource type="Resource" id="Resource_m07vp"]
script = ExtResource("9_4pava")
name = "Level 1"
room_prefabs = Array[PackedScene]([ExtResource("6_rw0ho"), ExtResource("7_h7aby"), ExtResource("8_vbhdp")])
metadata/_custom_type_script = "uid://drr3hic848gx0"

[node name="Atlinx" type="Node2D"]

[node name="World" type="Node2D" parent="."]
script = ExtResource("1_dfbem")

[node name="Player" parent="World" instance=ExtResource("2_r5bww")]
position = Vector2(384, 2176)

[node name="CameraRegionController2D" type="Node2D" parent="World" node_paths=PackedStringArray("camera", "target_node")]
script = ExtResource("3_rdygh")
camera = NodePath("../Camera2D")
target_node = NodePath("../Player")
metadata/_custom_type_script = "uid://boimiilxj3n2b"

[node name="Camera2D" type="Camera2D" parent="World"]
zoom = Vector2(0.05, 0.05)

[node name="LoopBar" parent="World" node_paths=PackedStringArray("rhythm_notifier") instance=ExtResource("4_u2tkb")]
rhythm_notifier = NodePath("../../LevelManager/RhythmNotifier")

[node name="LevelManager" type="Node" parent="." node_paths=PackedStringArray("camera_region_controller", "loop_bar", "player", "world", "rhythm_notifier", "bg_track_manager", "trans_color_rect", "load_fx")]
script = ExtResource("5_kt1sm")
level = SubResource("Resource_m07vp")
min_transition_duration = 2.0
camera_region_controller = NodePath("../World/CameraRegionController2D")
loop_bar = NodePath("../World/LoopBar")
player = NodePath("../World/Player")
world = NodePath("../World")
rhythm_notifier = NodePath("RhythmNotifier")
bg_track_manager = NodePath("../BGTrackManager")
trans_color_rect = NodePath("CanvasLayer/TransColorRect")
load_fx = NodePath("LoadFX")

[node name="RhythmNotifier" type="Node" parent="LevelManager" node_paths=PackedStringArray("audio_stream_player")]
script = ExtResource("10_ko8bd")
audio_stream_player = NodePath("../../BGTrackManager/BGTracksPlayer")
is_global = true
metadata/_custom_type_script = "uid://dqi2pls0xboqr"

[node name="CanvasLayer" type="CanvasLayer" parent="LevelManager"]

[node name="TransColorRect" type="ColorRect" parent="LevelManager/CanvasLayer"]
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
mouse_filter = 2
metadata/_edit_use_anchors_ = true

[node name="LoadFX" type="Node2D" parent="LevelManager"]
script = ExtResource("11_r5bww")
metadata/_custom_type_script = "uid://5vpj6ph24507"

[node name="Crash" type="AudioStreamPlayer" parent="LevelManager/LoadFX"]
stream = ExtResource("12_rdygh")

[node name="BGTrackManager" type="Node" parent="."]
script = ExtResource("11_0v5xw")
tracks = Array[AudioStream]([ExtResource("12_bbun0"), ExtResource("13_cjd40"), ExtResource("14_4741j"), ExtResource("15_d85kv"), ExtResource("16_vm263")])
fade_duration = 1.0
metadata/_custom_type_script = "uid://deofdsnkjeipf"

[node name="BGTracksPlayer" type="AudioStreamPlayer" parent="BGTrackManager"]
autoplay = true
